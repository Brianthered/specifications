:revdate: {docdate}
:version-label!: 
:sectnums:
:sectnumlevels: 5 
:chapter-label:
:source-highlighter: rouge

## Cryptography

### Hashing

All cryptographic hashes that are stored in a C2PA manifest shall be generated using one of the hash algorithms as described in this section. This section defines both:

* A list of hash algorithms that are allowed for generating hashes of new content as well as required for validating hashes of existing content (the allowed list), and
* A list of hash algorithms that are required to be supported for validating hashes of existing content but are not allowed for generating hashes of new content (the deprecated list).

NOTE: This section does not govern algorithms used for soft bindings as described in <<_soft_bindings>>.

An algorithm must appear in no more than one list. An algorithm that is instantiated over multiple output lengths (such as the various lengths of SHA2) will each be considered different algorithms, and each instantiation must be listed separately. If an algorithm does not appear in either list, it is forbidden and must not be used or supported. Algorithms can be removed from the lists in order to implement forbidding an algorithm. For this reason, implementations must not support additional algorithms on an optional basis.

Implementers should consult this section in the current version of the specification when releasing software updates and ensure their supported algorithms conform to it.

These lists establish the allowed algorithms for creating hashes and a string algorithm identifier to be used as the algorithm identifier (usually called `alg`) in the corresponding field of C2PA data structures. The outputs of hash functions shall be stored as their binary values encoded into CBOR as byte strings (major type 2) with a declared length. Wherever a field contains the output of a hash function, an algorithm identifier string field shall be present within the same structure, or within an enclosing structure, to declare which algorithm was used. A hash algorithm identifier field should be present in exactly one of these places, but if more than one is present within the structure and its enclosing structures, the nearest identifier must be used. Nearest is defined first as an identifier that is a sibling field of the hash value, and then the immediately enclosing structure, up to the root structure.

The allowed list is:

* SHA2-256 ("sha256")
* SHA2-384 ("sha384")
* SHA2-512 ("sha512")

[NOTE]
The SHA-3 family of hash algorithms are not on the allowed list for consistency with the digital signature algorithm allowed list, because COSE has not yet established digital signature algorithms that use a SHA-3 algorithm as the hash algorithm. A future version of this specification will incorporate SHA-3 for hashing as well as COSE digital signature algorithm that use SHA-3 when they are available.

The deprecated list is empty.

### Digital Signatures

All digital signatures that are stored in a C2PA manifest shall be generated using one of the digital signature algorithms and key types listed as described in this section. This section defines both:

* A list of digital signature algorithms and key types that are allowed for generating signatures of new content as well as required for validating signatures of existing content (the allowed list), and
* A list of digital signature algorithms and key types that are required to be supported for validating signatures of existing content but are not allowed for generating signatures of new context (the deprecated list).

These lists establish the allowed algorithms and key types by referencing an algorithm identifier from the relevant standards that define algorithms for COSE and their mappings to CBOR identifiers, including but not limited to https://tools.ietf.org/html/rfc8152[RFC 8152] and https://datatracker.ietf.org/doc/html/rfc8230/[RFC 8230]. These standards also specify the hash algorithm used in the signature scheme. Nothing in <<_hashing>> shall apply to this use of hash algorithms; if a digital signature algorithm is present in the digital signature algorithm and key type registry, the use of its specified hash algorithm in the signature scheme shall be allowed and followed.

NOTE: Parenthetical notes in the lists below are explainers provided only as an aid to the reader.

The allowed list is:

* `ES256` (ECDSA using P-256 and SHA-256)
* `ES384` (ECDSA using P-384 and SHA-384)
* `ES512` (ECDSA using P-521 and SHA-512)
* `PS256` (RSASSA-PSS using SHA-256 and MGF1 with SHA-256)
* `PS384` (RSASSA-PSS using SHA-384 and MGF1 with SHA-384)
* `PS512` (RSASSA-PSS using SHA-512 and MGF1 with SHA-512)
* `EdDSA`
** Ed25519 instance only. No other EdDSA instances are allowed.

The deprecated list is empty.

The signature for the CBOR-encoded claim is produced by CBOR Object Signing and Encryption (COSE) as described in RFC 8152 sections 4.2 and 4.4:

* The signature is computed or verified as described in https://datatracker.ietf.org/doc/html/rfc8152#section-4.4[RFC 8152 section 4.4]. The following additional requirements apply to the construction of `Sig_structure`:
** The value for the `context` element shall be `Signature1` except where a particular use of digital signatures in this specification specifies using `CounterSignature` instead. `Signature` shall not be used.
** The value for the `payload` element will be specified by each use of digital signatures in this specification.
** The `external_aad` element shall be a bstr of length zero. External authenticated data must not be used.
** The `alg` header specifying the signature algorithm shall be present in the `body_protected` element. https://datatracker.ietf.org/doc/html/rfc8152#section-3.1[RFC 8152 section 3.1]
+
[NOTE]
The `alg` header is a standard COSE header, and therefore is always included in the protected header map with the integer 1 as its key, as established in the https://www.iana.org/assignments/cose/cose.xhtml#header-parameters[IANA Cose Header Parameters Registry]. The literal string `alg` is never used as the key. The `sign_protected` element is always omitted when using `COSE_Sign1`.
+
* All digital signatures in C2PA structures shall be a `COSE_Sign1_Tagged` structure as defined in https://datatracker.ietf.org/doc/html/rfc8152#section-4.2[RFC 8152 section 4.2]. `COSE_Sign1_Tagged` contains a `COSE_Sign1` structure. The following additional requirements apply to the construction of `COSE_Sign1_Tagged`:
** The same `alg` header in the `Sig_structure` above shall be present in the `protected` header bucket.
** The `payload` field shall be nil.
+
[NOTE]
COSE defines `nil` to be major type 7, value 22 in https://datatracker.ietf.org/doc/html/rfc8152#section-1.3[section 1.3] and uses this value exclusively for detached content. A byte array (major type 2) of length zero cannot be used to indicate detached content.


